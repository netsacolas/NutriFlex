# üì± Guia de Configura√ß√£o PWA - NutriMais AI

## üéØ Vis√£o Geral

Este guia explica como configurar e testar o Progressive Web App (PWA) do NutriMais AI. Ap√≥s seguir essas instru√ß√µes, seu aplicativo ser√°:

- ‚úÖ **Instal√°vel** em celulares e desktops
- ‚úÖ **Funcional offline** (ap√≥s primeira visita)
- ‚úÖ **R√°pido** (carregamento em < 2 segundos)
- ‚úÖ **Nativo** (aparece como app na tela inicial)

---

## üìã Pr√©-requisitos

1. **Node.js** 18+ instalado
2. **NPM** ou **Yarn**
3. **HTTPS** configurado (necess√°rio para Service Workers em produ√ß√£o)
4. Navegadores compat√≠veis:
   - ‚úÖ Chrome/Edge 90+
   - ‚úÖ Safari 15.4+
   - ‚úÖ Firefox 90+
   - ‚úÖ Samsung Internet 15+

---

## üöÄ Passo 1: Gerar √çcones e Splash Screens

### 1.1. Gerar √çcones

1. Abra o arquivo no navegador:
   ```
   scripts/generate-icons.html
   ```

2. Clique em **"Gerar Todos os √çcones"**

3. Clique em **"Baixar Todos"**

4. Crie a pasta `public/icons/` no projeto:
   ```bash
   mkdir -p public/icons
   ```

5. Mova todos os arquivos `.png` baixados para `public/icons/`

**Resultado esperado:**
```
public/icons/
‚îú‚îÄ‚îÄ icon-72x72.png
‚îú‚îÄ‚îÄ icon-96x96.png
‚îú‚îÄ‚îÄ icon-128x128.png
‚îú‚îÄ‚îÄ icon-144x144.png
‚îú‚îÄ‚îÄ icon-152x152.png
‚îú‚îÄ‚îÄ icon-192x192.png
‚îú‚îÄ‚îÄ icon-384x384.png
‚îî‚îÄ‚îÄ icon-512x512.png
```

### 1.2. Gerar Splash Screens (iOS)

1. Abra o arquivo no navegador:
   ```
   scripts/generate-splash.html
   ```

2. Clique em **"Gerar Todas as Splash Screens"**

3. Clique em **"Baixar Todas"**

4. Crie a pasta `public/splash/`:
   ```bash
   mkdir -p public/splash
   ```

5. Mova todos os arquivos `.png` baixados para `public/splash/`

**Resultado esperado:**
```
public/splash/
‚îú‚îÄ‚îÄ splash-640x1136.png
‚îú‚îÄ‚îÄ splash-750x1334.png
‚îú‚îÄ‚îÄ splash-1125x2436.png
‚îú‚îÄ‚îÄ splash-828x1792.png
‚îú‚îÄ‚îÄ splash-1170x2532.png
‚îú‚îÄ‚îÄ splash-1242x2688.png
‚îú‚îÄ‚îÄ splash-1284x2778.png
‚îú‚îÄ‚îÄ splash-1179x2556.png
‚îú‚îÄ‚îÄ splash-1290x2796.png
‚îú‚îÄ‚îÄ splash-1536x2048.png
‚îú‚îÄ‚îÄ splash-1668x2224.png
‚îú‚îÄ‚îÄ splash-1668x2388.png
‚îî‚îÄ‚îÄ splash-2048x2732.png
```

---

## üîß Passo 2: Integrar Componentes PWA no App

### 2.1. Adicionar PWAManager ao App.tsx

Abra `App.tsx` e adicione no topo do componente:

```tsx
import { PWAManager } from './components/PWAComponents';
import { initBackgroundSync } from './utils/backgroundSync';
import { useEffect } from 'react';

function App() {
  // Inicializar sincroniza√ß√£o em background
  useEffect(() => {
    initBackgroundSync();
  }, []);

  return (
    <>
      {/* Componentes PWA */}
      <PWAManager />

      {/* Resto do seu app... */}
      {/* ... */}
    </>
  );
}
```

### 2.2. Adicionar Estilos de Anima√ß√£o

No final do `index.html`, adicione antes de `</head>`:

```html
<style>
  @keyframes slideDown {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .animate-slideDown {
    animation: slideDown 0.3s ease-out;
  }

  .animate-slideUp {
    animation: slideUp 0.5s ease-out;
  }
</style>
```

---

## üèóÔ∏è Passo 3: Build e Deploy

### 3.1. Build de Produ√ß√£o

```bash
npm run build
```

**Arquivos gerados em `dist/`:**
- `index.html`
- `manifest.json`
- `sw.js` (Service Worker)
- `icons/` (√≠cones)
- `splash/` (splash screens)
- Assets otimizados (JS, CSS)

### 3.2. Preview Local

```bash
npm run preview
```

Acesse: `http://localhost:4173`

### 3.3. Deploy em Produ√ß√£o

**Op√ß√µes de hosting compat√≠veis com PWA:**

#### Netlify
```bash
# netlify.toml
[build]
  command = "npm run build"
  publish = "dist"

[[headers]]
  for = "/sw.js"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"
    Service-Worker-Allowed = "/"

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
```

#### Vercel
```json
// vercel.json
{
  "headers": [
    {
      "source": "/sw.js",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=0, must-revalidate"
        },
        {
          "key": "Service-Worker-Allowed",
          "value": "/"
        }
      ]
    }
  ]
}
```

#### GitHub Pages
```yaml
# .github/workflows/deploy.yml
name: Deploy PWA
on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
      - run: npm ci
      - run: npm run build
      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
```

---

## üì± Passo 4: Testar Instala√ß√£o

### 4.1. Desktop (Chrome/Edge)

1. Abra o site em HTTPS
2. Procure o √≠cone de **instala√ß√£o** na barra de endere√ßo
3. Clique em **"Instalar NutriMais AI"**
4. O app abrir√° em janela pr√≥pria

**Ou use o menu:**
- Chrome: ‚ãÆ ‚Üí Instalar NutriMais AI
- Edge: ‚ãØ ‚Üí Apps ‚Üí Instalar este site como aplicativo

### 4.2. Android (Chrome)

1. Abra o site no Chrome
2. Aguarde 5 segundos (prompt aparecer√° automaticamente)
3. Ou toque em ‚ãÆ ‚Üí **"Adicionar √† tela inicial"**
4. Toque em **"Instalar"**
5. O √≠cone aparecer√° na gaveta de apps

### 4.3. iOS (Safari)

1. Abra o site no Safari
2. Toque no bot√£o **Compartilhar** (quadrado com seta)
3. Role e toque em **"Adicionar √† Tela de In√≠cio"**
4. Toque em **"Adicionar"**
5. O √≠cone aparecer√° na tela inicial

**Nota:** iOS n√£o suporta prompt autom√°tico de instala√ß√£o.

---

## üß™ Passo 5: Testar Funcionalidade Offline

### 5.1. Teste B√°sico

1. Abra o app
2. Navegue pelas p√°ginas principais
3. Abra as **DevTools** ‚Üí Aba **Application**
4. Sidebar: **Service Workers**
5. Marque **"Offline"**
6. Recarregue a p√°gina
7. **‚úÖ Deve funcionar!**

### 5.2. Teste de Cache

**Verificar recursos cacheados:**

1. DevTools ‚Üí Application ‚Üí Cache Storage
2. Deve ter 3 caches:
   - `nutrimais-v1` (recursos essenciais)
   - `nutrimais-runtime-v1` (APIs)
   - `nutrimais-images-v1` (imagens)

**Recursos esperados em cache:**
- `/index.html`
- `/manifest.json`
- √çcones `/icons/icon-*.png`
- Assets JS/CSS do build
- Fontes do Google Fonts

### 5.3. Teste de Sincroniza√ß√£o

1. Desconecte da internet
2. Tente adicionar uma refei√ß√£o/peso/atividade
3. Veja o **badge de sincroniza√ß√£o** no canto inferior direito
4. Reconecte √† internet
5. O badge deve desaparecer (dados sincronizados)

**Console esperado:**
```
üîÑ Sincronizando 3 itens pendentes...
‚úÖ Refei√ß√£o sincronizada: {...}
‚úÖ Peso sincronizado: {...}
‚úÖ Atividade sincronizada: {...}
üéâ Sincroniza√ß√£o completa!
```

---

## üîç Diagn√≥stico e Troubleshooting

### Lighthouse PWA Audit

1. DevTools ‚Üí Lighthouse
2. Selecione **"Progressive Web App"**
3. Clique **"Analyze page load"**

**Score esperado: 90-100**

**Checklist Lighthouse:**
- ‚úÖ Inst√°vel
- ‚úÖ Funciona offline
- ‚úÖ Manifest v√°lido
- ‚úÖ √çcones corretos
- ‚úÖ Service Worker ativo
- ‚úÖ HTTPS
- ‚úÖ Splash screen (iOS)
- ‚úÖ Orienta√ß√£o configurada
- ‚úÖ Viewport responsivo

### Problemas Comuns

#### ‚ùå Service Worker n√£o registra

**Causas:**
- N√£o est√° em HTTPS (exceto localhost)
- Caminho do `sw.js` incorreto
- CORS bloqueando recursos

**Solu√ß√£o:**
```bash
# Verificar console do navegador
# Deve mostrar:
‚úÖ Service Worker registrado com sucesso! /
```

#### ‚ùå Prompt de instala√ß√£o n√£o aparece

**Causas:**
- App j√° instalado
- Manifest inv√°lido
- Falta √≠cones
- N√£o est√° em HTTPS

**Solu√ß√£o:**
```bash
# Verificar manifest
curl https://seusite.com/manifest.json

# Deve retornar JSON v√°lido
```

#### ‚ùå N√£o funciona offline

**Causas:**
- Service Worker n√£o ativo
- Recursos n√£o cacheados
- Estrat√©gia de cache errada

**Solu√ß√£o:**
```javascript
// Verificar no console
navigator.serviceWorker.getRegistration().then(reg => {
  console.log('SW ativo:', reg.active);
});
```

#### ‚ùå √çcone n√£o aparece na tela inicial

**Causas:**
- √çcones 192x192 e 512x512 faltando
- Formato PNG incorreto
- Manifest n√£o linkado

**Solu√ß√£o:**
```bash
# Verificar √≠cones
ls -lh public/icons/
# Deve ter pelo menos icon-192x192.png e icon-512x512.png
```

---

## üìä Monitoramento em Produ√ß√£o

### M√©tricas Importantes

**1. Taxa de Instala√ß√£o**
```javascript
// Adicionar analytics
window.addEventListener('appinstalled', () => {
  gtag('event', 'pwa_installed');
});
```

**2. Uso Offline**
```javascript
window.addEventListener('offline', () => {
  gtag('event', 'pwa_offline');
});
```

**3. Service Worker Updates**
```javascript
navigator.serviceWorker.addEventListener('controllerchange', () => {
  gtag('event', 'pwa_updated');
});
```

### Tools Recomendadas

- **Lighthouse CI**: Auditorias automatizadas
- **PWA Builder**: Valida√ß√£o de manifest
- **Workbox**: Debugging de cache
- **Chrome DevTools**: Testes locais

---

## üé® Personaliza√ß√£o

### Alterar Cores do Tema

Em `manifest.json`:
```json
{
  "theme_color": "#ff6b35",       // Cor da barra de endere√ßo
  "background_color": "#1e1e1e"   // Cor de fundo ao carregar
}
```

### Alterar √çcone

1. Crie um novo √≠cone 512x512 (PNG)
2. Use o gerador online: [PWA Asset Generator](https://github.com/elegantapp/pwa-asset-generator)
3. Substitua os arquivos em `public/icons/`

### Alterar Nome do App

Em `manifest.json`:
```json
{
  "name": "Seu Nome Completo do App",
  "short_name": "Seu App"
}
```

---

## üö¢ Checklist de Produ√ß√£o

Antes de fazer deploy em produ√ß√£o:

- [ ] Todos os √≠cones gerados (8 tamanhos)
- [ ] Todas as splash screens geradas (13 tamanhos)
- [ ] `manifest.json` validado (use [Web Manifest Validator](https://manifest-validator.appspot.com/))
- [ ] Service Worker registrado corretamente
- [ ] HTTPS configurado
- [ ] Headers de seguran√ßa aplicados
- [ ] Lighthouse PWA score > 90
- [ ] Testado em Chrome, Safari e Firefox
- [ ] Testado em Android e iOS
- [ ] Funcionalidade offline verificada
- [ ] Sincroniza√ß√£o em background testada
- [ ] Prompt de instala√ß√£o funcionando
- [ ] Notifica√ß√£o de update funcionando
- [ ] Analytics configurado (opcional)

---

## üìö Recursos Adicionais

### Documenta√ß√£o Oficial
- [MDN PWA Guide](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps)
- [Google PWA Checklist](https://web.dev/pwa-checklist/)
- [Service Worker Cookbook](https://serviceworke.rs/)
- [Workbox Docs](https://developers.google.com/web/tools/workbox)

### Ferramentas
- [PWA Builder](https://www.pwabuilder.com/)
- [Maskable.app](https://maskable.app/) - Editor de √≠cones
- [Favicon Generator](https://realfavicongenerator.net/)
- [Lighthouse](https://developers.google.com/web/tools/lighthouse)

### Exemplos
- [PWA Examples](https://pwa-directory.appspot.com/)
- [Awesome PWA](https://github.com/hemanth/awesome-pwa)

---

## üÜò Suporte

**Problemas comuns?** Consulte a se√ß√£o de Troubleshooting acima.

**Encontrou um bug?** Abra uma issue no GitHub.

**Precisa de ajuda?** Consulte a documenta√ß√£o oficial do Vite e PWA.

---

**√öltima atualiza√ß√£o:** 2025-10-26
**Vers√£o:** 1.0.0
**Status:** ‚úÖ Pronto para produ√ß√£o

---

## üéâ Parab√©ns!

Seu aplicativo NutriMais AI agora √© um PWA completo e profissional! üöÄ

Os usu√°rios poder√£o:
- üì≤ Instalar como app nativo
- ‚ö° Usar offline ap√≥s primeira visita
- üîÑ Sincronizar dados automaticamente
- üöÄ Carregar 3x mais r√°pido
- üì± Ter uma experi√™ncia mobile perfeita

**Compartilhe com seus usu√°rios e veja a taxa de engajamento aumentar!**
