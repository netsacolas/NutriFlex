# ‚ö° Setup R√°pido - Integra√ß√£o Kiwify

## üéØ Resumo do Problema

A integra√ß√£o Kiwify est√° retornando erro 500 porque **os Secrets n√£o est√£o configurados no Supabase Vault**.

A Edge Function `kiwify-api` precisa de 3 vari√°veis de ambiente que s√≥ existem no seu `.env.local` (desenvolvimento local), mas **N√ÉO est√£o no Supabase** (produ√ß√£o).

---

## ‚úÖ Solu√ß√£o em 3 Passos

### Passo 1: Instalar Supabase CLI (se ainda n√£o tiver)

```bash
npm install -g supabase
```

Ou via Chocolatey (Windows):
```bash
choco install supabase
```

---

### Passo 2: Executar Script de Setup

Escolha uma das op√ß√µes:

#### Op√ß√£o A: Windows (Batch - Mais Simples)
```bash
scripts\setup-kiwify-secrets.bat
```

#### Op√ß√£o B: Windows (PowerShell)
```powershell
.\scripts\setup-kiwify-secrets.ps1
```

#### Op√ß√£o C: Git Bash / WSL / Linux
```bash
bash scripts/quick-setup-kiwify.sh
```

**O script vai:**
1. Verificar se voc√™ est√° autenticado no Supabase
2. Configurar os 3 Secrets automaticamente
3. Aguardar 30 segundos para propaga√ß√£o
4. Listar os Secrets configurados

---

### Passo 3: Deploy da Edge Function

```bash
supabase functions deploy kiwify-api
```

---

## üß™ Testar se Funcionou

### Op√ß√£o 1: Teste Automatizado (Recomendado)
```bash
node scripts/test-kiwify-integration.js
```

**Resultado esperado:**
```
‚úÖ TESTE 1: Conectividade - OK
‚úÖ TESTE 2: OAuth direto - OK
‚úÖ TESTE 3: Secrets no Supabase - OK
‚úÖ TESTE 4: Listar produtos - OK
‚úÖ TESTE 5: Vers√£o da Edge Function - OK

TODOS OS TESTES PASSARAM! üéâ
```

### Op√ß√£o 2: Teste Visual
Abra no navegador: `diagnostico-kiwify.html`

Clique em "Executar Todos os Testes" e veja os resultados.

---

## üìã Checklist de Verifica√ß√£o

- [ ] Supabase CLI instalado (`supabase --version`)
- [ ] Autenticado no Supabase (`supabase login`)
- [ ] Script de setup executado com sucesso
- [ ] Aguardou 30 segundos ap√≥s configurar Secrets
- [ ] Edge Function deployada (`supabase functions deploy kiwify-api`)
- [ ] Teste automatizado passou (5/5 OK)

---

## üêõ Se Algo Der Errado

### Erro: "supabase: command not found"
**Solu√ß√£o**: Instale o Supabase CLI:
```bash
npm install -g supabase
```

### Erro: "You must be logged in"
**Solu√ß√£o**: Fa√ßa login:
```bash
supabase login
```

### Erro: "Failed to set secret"
**Solu√ß√£o**: Verifique se tem permiss√£o no projeto:
```bash
supabase projects list
```
Voc√™ deve ver `keawapzxqoyesptwpwav` na lista.

### Teste ainda falha ap√≥s setup
**Solu√ß√£o**: Aguarde mais tempo (at√© 2 minutos) e teste novamente:
```bash
# Aguardar
timeout 60

# Testar
node scripts/test-kiwify-integration.js
```

---

## üìö Credenciais Configuradas

O script configura automaticamente estes 3 Secrets:

| Secret Name | Valor |
|-------------|-------|
| `KIWIFY_CLIENT_ID` | `4c7f47409-c212-45d1-aaf9-4a5d43dac808` |
| `KIWIFY_CLIENT_SECRET` | `00d8f9dc83a5afeeee0fe459cfb5265272b95e5458c4908411273e5dfac` |
| `KIWIFY_ACCOUNT_ID` | `av8qNBGVVoyVD75` |

---

## üîí Seguran√ßa

- ‚úÖ Os Secrets s√£o armazenados de forma segura no Supabase Vault
- ‚úÖ Nunca s√£o expostos no frontend
- ‚úÖ Acess√≠veis apenas pelas Edge Functions
- ‚ö†Ô∏è N√ÉO commite o arquivo `.env.local` no Git

---

## üöÄ Ap√≥s Configurar

Com os Secrets configurados e a Edge Function deployada, voc√™ poder√°:

1. ‚úÖ Testar autentica√ß√£o OAuth com Kiwify
2. ‚úÖ Listar produtos da sua conta
3. ‚úÖ Sincronizar assinaturas automaticamente
4. ‚úÖ Receber webhooks de compra
5. ‚úÖ Liberar acesso Premium para usu√°rios

---

## üìû Precisa de Ajuda?

Se ap√≥s executar todos os passos ainda houver erro:

1. Execute o diagn√≥stico completo:
   ```bash
   node scripts/test-kiwify-integration.js > debug.txt 2>&1
   ```

2. Envie o arquivo `debug.txt` para an√°lise

3. Ou abra `test-erro-detalhado.html` no navegador e copie o output completo

---

**Tempo estimado**: 5 minutos
**Dificuldade**: F√°cil
**Pr√©-requisito**: Node.js instalado

---

**√öltima atualiza√ß√£o**: 2025-01-11
**Vers√£o**: 1.0.0
